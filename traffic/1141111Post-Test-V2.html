<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>鷺江國小 交通安全教育前後測問卷</title>
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 使用 'Inter' 字體 */
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            /* [美化] 使用更柔和的背景色 */
            background-color: #f9fafb; /* bg-gray-50 */
        }
        /* 自訂樣式，用於必填問題的提示 */
        .question-required::after {
            content: ' *';
            color: #ef4444; /* red-500 */
        }
        
        /* [美化] 增加 Likert 表格的 hover 效果 */
        .likert-table tbody tr:hover {
            background-color: #f9fafb; /* bg-gray-50 */
        }

        /* Likert 表格的響應式樣式 */
        .likert-table {
            width: 100%;
            border-collapse: collapse;
        }
        /* [學生版] 加大表格內距和字體 */
        .likert-table th, .likert-table td {
            padding: 1rem 1.25rem; /* p-4 p-5 */
            text-align: center;
            border: 1px solid #e5e7eb; /* gray-200 */
            white-space: normal;
            font-size: 1rem; /* text-base */
            line-height: 1.5rem;
        }
        .likert-table th:not(:first-child) {
            max-width: 120px;
            font-weight: 500; 
            background-color: #f9fafb; /* bg-gray-50 */
        }
         /* [學生版] 加寬問題欄位 */
        .likert-table td:first-child, .likert-table th:first-child {
            text-align: left;
            white-space: normal;
            min-width: 350px;
            font-weight: 500; 
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- [學生版] 調整 max-w-6xl (1152px) -> max-w-7xl (1280px) -->
    <!-- [學生版] 增加邊框 border-t-8 -> border-t-[12px] -->
    <!-- [學生版] 增加圓角/陰影/邊距 rounded-xl -> rounded-2xl, shadow-xl -> shadow-2xl, my-10 -> my-12 -->
    <!-- [學生版] 增加 padding p-4 sm:p-8 -> p-6 sm:p-12 -->
    <div class="container mx-auto max-w-7xl p-6 sm:p-12 bg-white shadow-2xl rounded-2xl my-12 border-t-[12px] border-blue-600">

        <!-- [學生版] 增加 mb-10 -> mb-12, pb-6 -> pb-8 -->
        <header class="text-center mb-12 pb-8 border-b border-gray-200">
            <div class="flex justify-center items-center gap-4">
                <!-- [學生版] 加大圖示 h-12 w-12 -> h-16 w-16 -->
                <svg class="h-16 w-16 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 21v-8.25M15.75 21v-8.25M8.25 21v-8.25M3 9l9-6 9 6m-1.5 12V10.332A48.36 48.36 0 0 0 12 9.75c-2.551 0-5.056.2-7.5.582V21M3 21h18M12 6.75h.008v.008H12V6.75Z" />
                </svg>
                <!-- [學生版] 放大標題 text-4xl -> text-5xl -->
                <h1 class="text-5xl font-bold text-blue-700">交通安全教育前後測問卷</h1>
            </div>
            <!-- [學生版] 放大副標題 text-xl -> text-2xl, mt-3 -> mt-4 -->
            <p class="text-2xl text-gray-600 mt-4">鷺江國小</p>
        </header>

        <!-- 提交表單 -->
        <!-- [學生版] 增加 space-y-12 -> space-y-16 -->
        <form id="surveyForm" class="space-y-16">

            <!-- 基本資料 -->
            <!-- [學生版] 增加 padding p-6 -> p-8, rounded-lg -> rounded-xl -->
            <!-- [學生版] 加深顏色 bg-blue-50 -> bg-blue-100, border-blue-200 -> border-blue-300 -->
            <section class="bg-blue-100 p-8 rounded-xl shadow-md border border-blue-300">
                <!-- [學生版] 放大標題 text-2xl -> text-3xl, mb-6 -> mb-8 -->
                <h2 class="text-3xl font-semibold text-blue-700 mb-8 border-l-4 border-blue-600 pl-4">基本資料</h2>
                <!-- [學生版] 增加 gap-6 -> gap-8 -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <!-- [學生版] 放大標籤 text-sm -> text-base -->
                        <label for="classYear" class="block text-base font-medium text-gray-700 question-required">班級 (年)</label>
                        <!-- [學生版] 放大輸入框 p-3 text-base -->
                        <input type="number" name="classYear" id="classYear" placeholder="例如: 5" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-3 text-base" min="0">
                    </div>
                    <div>
                        <label for="classNum" class="block text-base font-medium text-gray-700 question-required">班級 (班)</label>
                        <input type="number" name="classNum" id="classNum" placeholder="例如: 1" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-3 text-base" min="0">
                    </div>
                    <div>
                        <label for="seatNo" class="block text-base font-medium text-gray-700 question-required">座號</label>
                        <input type="number" name="seatNo" id="seatNo" placeholder="例如: 12" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-3 text-base" min="0">
                    </div>
                    <div>
                        <label for="studentName" class="block text-base font-medium text-gray-700 question-required">姓名</label>
                        <input type="text" name="studentName" id="studentName" placeholder="例如: 王小明" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-3 text-base">
                    </div>
                    <div>
                        <label class="block text-base font-medium text-gray-700 question-required">性別</label>
                        <div class="mt-2 space-x-6">
                            <label class="inline-flex items-center">
                                <!-- [學生版] 放大選項 h-4 w-4 -> h-5 w-5, ml-2 -> ml-3, text-base -->
                                <input type="radio" name="gender" value="男" required class="focus:ring-blue-500 h-5 w-5 text-blue-600 border-gray-300">
                                <span class="ml-3 text-base text-gray-800">男</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" name="gender" value="女" required class="focus:ring-blue-500 h-5 w-5 text-blue-600 border-gray-300">
                                <span class="ml-3 text-base text-gray-800">女</span>
                            </label>
                        </div>
                    </div>
                    <div>
                        <label class="block text-base font-medium text-gray-700 question-required">這份問卷是：</label>
                        <div class="mt-2 space-x-6">
                            <label class="inline-flex items-center">
                                <input type="radio" name="testType" value="前測" required class="focus:ring-blue-500 h-5 w-5 text-blue-600 border-gray-300">
                                <span class="ml-3 text-base text-gray-800">前測（上課前）</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" name="testType" value="後測" required class="focus:ring-blue-500 h-5 w-5 text-blue-600 border-gray-300">
                                <span class="ml-3 text-base text-gray-800">後測（上課後）</span>
                            </label>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 輔助函數：生成選擇題 -->
            <script>
                // 存儲問題數據
                const questions = {
                    part1: [
                        { id: 'k1', text: '1. 自行車座墊的「最適合高度」是？', options: ['雙腳可以完全平踩在地上。', '腳踩到地面時，膝蓋呈現微微彎曲。', '腳尖剛好可以踮到地上。', '越高越好，騎起來比較快。'] },
                        { id: 'k2', text: '2. 遇到右轉的大型車（公車、卡車），最危險的區域是？', options: ['車輛的左後方。', '車輛的正後方。', '車輛的右前方與右側（因為視野死角和內輪差）。', '車輛的正前方。'] },
                        { id: 'k3', text: '3. 有「兩段式左轉」標誌的路口，應如何左轉？', options: ['直接跟著汽車一起左轉。', '等沒車時再直接左轉。', '依照標誌，先騎到對面的待轉區，等綠燈再直行。', '舉手示意後，直接左轉。'] },
                        { id: 'k4', text: '4. 路口號誌「閃紅燈」對上「閃黃燈」，誰該停下禮讓？', options: ['閃黃燈（幹道）要讓閃紅燈（支道）。', '閃紅燈（支道）要停下，讓閃黃燈（幹道）先行。', '兩邊都可以直接通過。', '騎自行車的要讓所有汽車。'] },
                        { id: 'k5', text: '5. 變換車道或轉彎前，最正確的做法是？', options: ['只要後面沒車就可以直接換。', '舉起控制「前輪」煞車的手來做轉彎手勢，並擺頭查看。', '只要按鈴鐺，提醒別人注意就好。', '騎在最外側車道，不需要打手勢。'] },
                        { id: 'k6', text: '6. 前方有公車停在路邊，你該怎麼做？', options: ['保持原速從公車左側繞過去。', '減速，注意公車前方是否有人衝出，並保持距離繞行。', '停在公車後面，等公車開走再騎。', '騎到人行道上繞過去。'] },
                        { id: 'k7', text: '7. 無號誌路口，我要「直行」，對向車要「左轉」，誰應該優先行？', options: ['直行的自行車。', '左轉的對向車。', '誰的車速快，誰就先過。', '自行車應該禮讓所有汽車。'] },
                        { id: 'k8', text: '8. 自行車上路前，檢查「煞車」的正確方式是？', options: ['只要用眼睛看煞車線還在就好。', '邊騎邊按，看能不能停。', '停著的狀態下，前後輕推車子，同時按下煞車看是否能停止。', '煞車塊磨損是正常的，不用檢查。'] },
                        { id: 'k9', text: '9. 騎車「掉鏈條」（落鏈），簡易的處理方式是？', options: ['馬上停下，打電話請人來修。', '不用處理，只是會騎起來很費力。', '用手或工具將鏈条「掛回」齒輪上，再轉動踏板。', '這是正常現象，騎快一點就會自動恢復。'] },
                        { id: 'k10', text: '10. 依交通法規，自行車被歸類為？', options: ['行人。', '運動器材。', '慢車（車輛駕駛人）。', '玩具。'] }
                    ],
                    part4: [
                        { id: 's1', text: '1. 學校正門（民族路）有很多公車。當公車要右轉時，如何避開「內輪差」最安全？', options: ['停在公車的右側或右前方。', '保持距離，停在公車的「正後方」等待。', '快速從公車的右側縫隙鑽過去。', '盡量靠近公車，讓司機看到。'] },
                        { id: 's2', text: '2. 坐機車到學校時，最安全的下車方式是？', options: ['在馬路中間下車，再自己跑過去。', '在「機車接送區」停穩，從靠近人行道的「右側」下車。', '從機車「左側」下車，再繞過車頭。', '車一停，馬上跳下車往校門衝。'] },
                        { id: 's3', text: '3. 交通崗會宣導「用走代替跑」。是因為在校門口奔跑會造成什麼危險？', options: ['跑太快會流汗。', '奔跑時，容易忽略巷口或停車格衝出的車輛。', '會撞到同學。', '(2) 和 (3) 都是。'] },
                        { id: 's4', text: '4. 學校民族路上正門口（正門）常「壅塞」且「汽機車與公車爭道」，如果你走在民族路時遇到公車停靠，該怎麼辦？', options: ['從公車的左側（馬路）繞過去。', '停在公車後面，等公車開走。', '減速，注意公車前方是否有人衝出，並保持距離繞行。', '鑽進公車底下。'] },
                        { id: 's5', text: '5. 學校有分「汽車」和「機車」接送區，如果家長是「開汽車」來接孩子，應該停在哪裡？', options: ['停在「機車接送區」。', '停在「汽車接送區」的指定格內。', '併排停車在馬路上。', '停在公車停靠區。'] },
                        { id: 's6', text: '6. 學校在「民族路」與「民權路」交會處。若騎自行車要左轉，就算該路口沒有待轉區，最安全的方法是？', options: ['跟著汽車，切換到「內側車道」直接左轉。', '保持在「外側車道」，先直行到路口對面，再等一次綠燈後直行通過。', '趁無來車時，直接從「外側車道」斜切（切西瓜）左轉。', '舉手示意後，直接從外側車道左轉。'] },
                        { id: 's7', text: '7. 校門口警員會宣導機車「勿逗留太久」。是因為在機車接送區「逗留太久」會造成什麼危險？', options: ['會讓後方的機車回堵到馬路上，造成混亂。', '會被警察開罰單。', '會讓老師不開心。', '以上皆是。'] },
                        { id: 's8', text: '8. 民權路側門雖然「交通相對舒緩」。走出這個校門要穿越馬路時，應該要怎麼做？', options: ['車較少，直接跑過去。', '雖然車少，仍應「停、看、聽」，走行人穿越道。', '綠燈時，可以低頭看手機通過。', '只要看左邊來車就好。'] },
                        { id: 's9', text: '9. 資訊課學到回家路上有「交通肇事熱點」。請問，你經過交通肇事熱點路口時，應該要怎麼做？', options: ['盡全力快速衝過去。', '放學後在那些路口玩，觀察危險。', '提醒爸媽，並在通過時特別放慢、加強注意。', '堅持換一條路，繞遠路也沒關係。'] },
                        { id: 's10', text: '10. 當你走路經過路邊停滿車的人行道時，如何避免被「突然打開的車門」撞到？', options: ['緊貼著車子走。', '邊走邊滑手機。', '盡量走在人行道內側，並和車子保持一個車門的距離。', '走在路中央。'] }
                    ]
                };

                // 函數：生成單選題 HTML
                function createMultipleChoice(q) {
                    // [學生版] 放大選項 p-3 -> p-4, h-4 w-4 -> h-5 w-5, ml-3 -> ml-4, text-base, hover:bg-blue-100
                    const optionsHtml = q.options.map((option, index) => `
                        <label class="block ml-2 p-4 rounded-md hover:bg-blue-100 transition-colors duration-150 cursor-pointer">
                            <input type="radio" name="${q.id}" value="${index + 1}" required class="focus:ring-blue-500 h-5 w-5 text-blue-600 border-gray-300">
                            <span class="ml-4 text-base text-gray-800">${option}</span>
                        </label>
                    `).join('');

                    // [學生版] 放大問題 p-5 -> p-6, rounded-lg -> rounded-xl, text-lg -> text-xl
                    return `
                        <div class="mb-6 p-6 bg-white border border-gray-200 rounded-xl shadow-md">
                            <p class="font-medium text-xl text-gray-900 question-required">${q.text}</p>
                            <div class="mt-3 space-y-2">
                                ${optionsHtml}
                            </div>
                        </div>
                    `;
                }
            </script>

            <!-- 第一部分：安全知識 (K) -->
            <!-- [學生版] 增加 padding p-6 -> p-8, rounded-lg -> rounded-xl -->
            <!-- [學生版] 加深顏色 bg-green-50 -> bg-green-100, border-green-200 -> border-green-300 -->
            <section class="bg-green-100 p-8 rounded-xl shadow-md border border-green-300">
                <!-- [學生版] 放大標題 text-2xl -> text-3xl, mb-6 -> mb-8 -->
                <h2 class="text-3xl font-semibold text-green-700 mb-8 border-l-4 border-green-600 pl-4">第一部分：安全知識 (K)</h2>
                <!-- [學生版] 放大說明 text-base -> text-lg, mb-6 -> mb-8 -->
                <p class="text-lg text-gray-600 mb-8 -mt-2 ml-1">（請選出一個 <strong>最正確</strong> 的答案）</p>
                <div id="part1-questions" class="space-y-6"></div>
                <script>
                    const part1Container = document.getElementById('part1-questions');
                    part1Container.innerHTML = questions.part1.map(createMultipleChoice).join('');
                </script>
            </section>

            <!-- 輔助函數：生成 Likert 表格 -->
            <script>
                // Likert 問題數據
                const likertQuestions = {
                    part2: [
                        { id: 'a1', text: '11. 我認為每次騎車前，檢查自行車（煞車、輪胎）是必要的。' },
                        { id: 'a2', text: '12. 我覺得技術好，不遵守交通規則（如兩段式左轉）也沒關係。' },
                        { id: 'a3', text: '13. 我相信騎車戴安全帽，能真正保護頭部安全。' },
                        { id: 'a4', text: '14. 我認為騎車打手勢（示意轉彎）很麻煩且沒必要。' },
                        { id: 'a5', text: '15. 遇到大型車時，我會特別警覺並主動遠離。' },
                        { id: 'a6', text: '16. 我覺得自行車是「車輛」，上路就該遵守車輛規則。' },
                        { id: 'a7', text: '17. 我認為在巷口或路口，就算直行也該減速查看。' },
                        { id: 'a8', text: '18. 我覺得和朋友「並排騎車」聊天，比「前後一列」安全。' },
                        { id: 'a9', text: '19. 我相信學會處理「掉鏈條」，對安全騎乘很有幫助。' },
                        { id: 'a10', text: '20. 我認為騎車時，讓他人能「預測」我的行為很重要（如不S型）。' }
                    ],
                    part3: [
                        { id: 'b1', text: '21. 騎車前，我「會」先檢查煞車是否靈敏。' },
                        { id: 'b2', text: '22. 即使只在住家附近，我「會」堅持戴安全帽。' },
                        { id: 'b3', text: '23. 和朋友騎車，我「會」提醒大家「前後一列」，不並排。' },
                        { id: 'b4', text: '24. 轉彎或變換車道時，我「會」擺頭查看並打手勢。' },
                        { id: 'b5', text: '25. 看到公車或卡車時，我「會」主動騎得遠一點。' },
                        { id: 'b6', text: '26. 即使是綠燈，過路口時我也「會」減速查看左右來車。' },
                        { id: 'b7', text: '27. 路邊停車時，我「會」保持一個車門的距離。' },
                        { id: 'b8', text: '28. 在複雜路口左轉，我「會」優先使用兩段式左轉。' },
                        { id: 'b9', text: '29. 騎車時，我「會」要求自己專心注意路況，不分心。' },
                        { id: 'b10', text: '30. 騎車前，我「會」先確認座墊是否牢固且高度適合。' }
                    ]
                };

                // 函數：生成 Likert 表格 HTML
                function createLikertTable(questions, partNumber) {
                    const part2Headers = ['非常同意', '同意', '普通', '不同意', '非常不同意'];
                    const part3Headers = ['非常同意 (我一定會)', '同意 (我應該會)', '普通', '不同意 (我應該不會)', '非常不同意 (我一定不會)'];
                    
                    const headers = (partNumber === 2) ? part2Headers : part3Headers;
                    const values = [5, 4, 3, 2, 1]; // 分數

                    // [學生版] 放大表頭 text-base
                    const headerHtml = headers.map(h => `<th class="font-semibold text-base">${h}</th>`).join('');
                    
                    const rowsHtml = questions.map(q => {
                        // [學生版] 放大選項 p-2 -> p-3, h-5 -> h-6
                        const optionsHtml = values.map(v => `
                            <td class="text-center">
                                <label class="cursor-pointer p-3 flex justify-center items-center">
                                    <input type="radio" name="${q.id}" value="${v}" required class="focus:ring-blue-500 h-6 w-6 text-blue-600 border-gray-300">
                                </label>
                            </td>
                        `).join('');
                        
                        return `
                            <tr>
                                <!-- [學生版] 放大問題 text-base -->
                                <td class="text-left font-medium question-required text-base">${q.text}</td>
                                ${optionsHtml}
                            </tr>
                        `;
                    }).join('');

                    // [學生版] 增加圓角 rounded-lg -> rounded-xl
                    return `
                        <div class="overflow-x-auto bg-white rounded-xl shadow-md border border-gray-200">
                            <table class="likert-table">
                                <thead>
                                    <tr>
                                        <th class="text-left text-base">題目</th>
                                        ${headerHtml}
                                    </tr>
                                </thead>
                                <tbody>
                                    ${rowsHtml}
                                </tbody>
                            </table>
                        </div>
                    `;
                }
            </script>

            <!-- 第二部分：安全態度 (A) -->
            <!-- [學生版] 增加 padding p-6 -> p-8, rounded-lg -> rounded-xl -->
            <!-- [學生版] 加深顏色 bg-yellow-50 -> bg-yellow-100, border-yellow-200 -> border-yellow-300 -->
            <section class="bg-yellow-100 p-8 rounded-xl shadow-md border border-yellow-300">
                <!-- [學生版] 放大標題 text-2xl -> text-3xl, mb-6 -> mb-8 -->
                <h2 class="text-3xl font-semibold text-yellow-700 mb-8 border-l-4 border-yellow-600 pl-4">第二部分：安全態度 (A)</h2>
                <!-- [學生版] 放大說明 text-base -> text-lg, mb-6 -> mb-8 -->
                <p class="text-lg text-gray-600 mb-8 -mt-2 ml-1">（請勾選你對以下說法的同意程度）</p>
                <div id="part2-questions"></div>
                <script>
                    const part2Container = document.getElementById('part2-questions');
                    part2Container.innerHTML = createLikertTable(likertQuestions.part2, 2);
                </script>
            </section> 

            <!-- 第三部分：安全意向與實踐 (B) -->
            <!-- [學生版] 增加 padding p-6 -> p-8, rounded-lg -> rounded-xl -->
            <!-- [學生版] 加深顏色 bg-purple-50 -> bg-purple-100, border-purple-200 -> border-purple-300 -->
            <section class="bg-purple-100 p-8 rounded-xl shadow-md border border-purple-300">
                <!-- [學生版] 放大標題 text-2xl -> text-3xl, mb-6 -> mb-8 -->
                <h2 class="text-3xl font-semibold text-purple-700 mb-8 border-l-4 border-purple-600 pl-4">第三部分：安全意向與實踐 (B)</h2>
                <!-- [學生版] 放大說明 text-base -> text-lg, mb-6 -> mb-8 -->
                <p class="text-lg text-gray-600 mb-8 -mt-2 ml-1">（請想像你「未來有機會」騎自行車時，你「會這麼做」的同意程度）</p>
                <div id="part3-questions"></div>
                <script>
                    const part3Container = document.getElementById('part3-questions');
                    part3Container.innerHTML = createLikertTable(likertQuestions.part3, 3);
                </script>
            </section> 

            <!-- 第四部分：鷺江國小情境應用題 -->
            <!-- [學生版] 增加 padding p-6 -> p-8, rounded-lg -> rounded-xl -->
            <!-- [學生版] 加深顏色 bg-red-50 -> bg-red-100, border-red-200 -> border-red-300 -->
            <section class="bg-red-100 p-8 rounded-xl shadow-md border border-red-300">
                <!-- [學生版] 放大標題 text-2xl -> text-3xl, mb-6 -> mb-8 -->
                <h2 class="text-3xl font-semibold text-red-700 mb-8 border-l-4 border-red-600 pl-4">第四部分：鷺江國小情境應用題</h2>
                <!-- [學生版] 放大說明 text-base -> text-lg, mb-6 -> mb-8 -->
                <p class="text-lg text-gray-600 mb-8 -mt-2 ml-1">（此部分題目將會收集，但您可以提醒學生在「前測」時若不會可先跳過）</p>
                <div id="part4-questions" class="space-y-6"></div>
                <script>
                    const part4Container = document.getElementById('part4-questions');
                    part4Container.innerHTML = questions.part4.map(createMultipleChoice).join('');
                </script>
            </section>

            <!-- 提交按鈕 -->
            <div class="text-center pt-8 border-t border-gray-200">
                <!-- [學生版] 放大按鈕 px-16 py-4 -> px-20 py-5, text-lg -> text-xl, w-6 h-6 -> w-7 h-7, shadow-lg -> shadow-xl -->
                <button type="submit" id="submitButton" class="w-full sm:w-auto inline-flex justify-center items-center gap-3 px-20 py-5 border border-transparent text-xl font-medium rounded-full shadow-xl text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-300 ease-in-out transform hover:scale-105">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-7 h-7">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L6 12Z" />
                    </svg>
                    送出問卷
                </button>
            </div>

        </form>

        <!-- 訊息提示框 -->
        <div id="messageBox" class="hidden fixed inset-0 bg-gray-600 bg-opacity-75 overflow-y-auto h-full w-full z-50 transition-opacity duration-300">
            <!-- [學生版] 放大彈窗 max-w-md -> max-w-lg, rounded-2xl -> rounded-3xl -->
            <div class="relative top-20 mx-auto p-6 border w-full max-w-lg shadow-xl rounded-3xl bg-white transition-all duration-300 transform scale-95 opacity-0" id="messageBoxContent">
                <div class="mt-3 text-center">
                    <!-- [學生版] 放大標題 text-2xl -> text-3xl -->
                    <h3 id="messageTitle" class="text-3xl leading-6 font-bold text-gray-900"></h3>
                    <div class="mt-4 px-7 py-3">
                        <!-- [學生版] 放大內文 text-base -> text-lg -->
                        <p id="messageText" class="text-lg text-gray-600"></p>
                    </div>
                    <div class="items-center px-4 py-3">
                         <!-- [學生版] 放大按鈕 px-6 py-3 -> px-8 py-4, text-base -> text-lg -->
                        <button id="messageCloseButton" class="px-8 py-4 bg-blue-600 text-white text-lg font-medium rounded-lg w-full shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200">
                            關閉
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- ########## JAVASCRIPT 修改區域 ########## -->
    <script>
        // ------------------------------------------------------------------
        // const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyfwYn3avf3t9Ygopw1kEQmJtL60OYY9Fwy4BYwjrEAkW88dn7fU7UssM3ZzdQEGOrHEQ/exec"; // <--- ！！請務必替換成您自己的網址！！
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzmPK0N8_yNpEDjOIb4UJlhaFjn4T6r2LUR7R2uOUZd3d-Fmi1dUrmrsAHzfWjqZwsb_Q/exec"; // <--- ！！請務必替換成您自己的網址！！

        // DOM 元素
        const form = document.getElementById('surveyForm');
        const submitButton = document.getElementById('submitButton');
        const messageBox = document.getElementById('messageBox');
        const messageBoxContent = document.getElementById('messageBoxContent');
        const messageTitle = document.getElementById('messageTitle');
        const messageText = document.getElementById('messageText');
        const messageCloseButton = document.getElementById('messageCloseButton');
        
        // --- 答案對照表 ---
        // (選項的 value 是從 1 開始)
        const answerKeyPart1 = {
            'k1': '2', 'k2': '3', 'k3': '3', 'k4': '2', 'k5': '2',
            'k6': '2', 'k7': '1', 'k8': '3', 'k9': '3', 'k10': '3'
        };
        const answerKeyPart4 = {
            's1': '2', 's2': '2', 's3': '4', 's4': '3', 's5': '2',
            's6': '2', 's7': '1', 's8': '2', 's9': '3', 's10': '3'
        };

        // --- 計分函數 ---
        function calculateScores() {
            const formData = new FormData(form); // 取得當前表單所有資料
            let scorePart1 = 0;
            let scorePart4 = 0;

            // 計算第一部分 (K)
            for (const [id, correctValue] of Object.entries(answerKeyPart1)) {
                if (formData.get(id) === correctValue) {
                    scorePart1 += 10;
                }
            }

            // 計算第四部分 (S)
            for (const [id, correctValue] of Object.entries(answerKeyPart4)) {
                if (formData.get(id) === correctValue) {
                    scorePart4 += 10;
                }
            }
            return { scorePart1, scorePart4 };
        }
        
        // --- 顯示分數的函數 (取代舊的 showMessage) ---
        function showScoreMessage(title, scorePart1, scorePart4) {
            const scoreHtml = `
                感謝您的填答，問卷已成功送出。<br><br>
                <strong class='text-xl'>第一部分 (安全知識) 得分: ${scorePart1} / 100</strong><br>
                <strong class='text-xl'>第四部分 (情境應用) 得分: ${scorePart4} / 100</strong>
                <br><br>
                <small>(此視窗將在 10 秒後自動關閉)</small>
            `;
            
            messageTitle.textContent = title;
            messageText.innerHTML = scoreHtml; // 使用 innerHTML 才能顯示換行和粗體
            
            messageBox.classList.remove('hidden');
            // [美化] 觸發動畫
            setTimeout(() => {
                messageBox.classList.remove('opacity-0');
                messageBoxContent.classList.remove('scale-95', 'opacity-0');
                messageBoxContent.classList.add('scale-100', 'opacity-100');
            }, 10);
            
            // 10秒後自動關閉
            setTimeout(hideMessage, 10000);
        }

        // 顯示一般訊息框 (用於錯誤)
        function showMessage(title, text) {
            messageTitle.textContent = title;
            messageText.textContent = text; // 一般訊息用 textContent
            messageBox.classList.remove('hidden');
            // [美化] 觸發動畫
            setTimeout(() => {
                messageBox.classList.remove('opacity-0');
                messageBoxContent.classList.remove('scale-95', 'opacity-0');
                messageBoxContent.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        // 關閉訊息框
        function hideMessage() {
            messageBoxContent.classList.remove('scale-100', 'opacity-100');
            messageBoxContent.classList.add('scale-95', 'opacity-0');
            messageBox.classList.add('opacity-0');
            setTimeout(() => {
                messageBox.classList.add('hidden');
            }, 300); // 等待動畫完成
        }

        messageCloseButton.addEventListener('click', hideMessage);
        messageBox.addEventListener('click', (e) => {
            if (e.target === messageBox) {
                hideMessage();
            }
        });


        // 提交表單處理
        form.addEventListener('submit', async (e) => {
            e.preventDefault(); // 防止表單直接提交

            // 檢查 URL 是否已設定
            if (SCRIPT_URL.includes("YOUR_APPS_SCRIPT_WEB_APP_URL")) {
                showMessage("設定錯誤", "請先在 index.html 檔案中設定您的 Google Apps Script 網路應用程式網址 (SCRIPT_URL)。");
                return;
            }

            // 簡易的必填驗證
            const requiredInputs = form.querySelectorAll('[required]');
            let firstInvalidInput = null;

            for (const input of requiredInputs) {
                if (input.type === 'radio') {
                    const groupName = input.name;
                    if (!form.querySelector(`input[name="${groupName}"]:checked`)) {
                        firstInvalidInput = input;
                        break;
                    }
                } else {
                    if (!input.value.trim()) {
                        firstInvalidInput = input;
                        break;
                    }
                    if (input.type === 'number' && input.min !== '' && parseFloat(input.value) < parseFloat(input.min)) {
                        firstInvalidInput = input;
                        break;
                    }
                }
            }

            if (firstInvalidInput) {
                if (firstInvalidInput.type === 'number' && firstInvalidInput.min !== '' && parseFloat(firstInvalidInput.value) < parseFloat(firstInvalidInput.min)) {
                     showMessage("內容錯誤", `欄位 "${firstInvalidInput.previousElementSibling.textContent}" 不能是負數。`);
                } else {
                    showMessage("尚未填寫完成", "請檢查所有標記 * 的必填問題。");
                }
                
                // 捲動到第一個未填寫的問題
                const invalidElement = firstInvalidInput.closest('section, .mb-6, tr');
                if (invalidElement) {
                    invalidElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    // [美化] 閃爍提示未填寫的區塊
                    invalidElement.classList.add('transition-all', 'duration-300', 'bg-red-100');
                    setTimeout(() => {
                        invalidElement.classList.remove('bg-red-100');
                    }, 2000);
                }
                return;
            }

            // --- 【修改】將分數宣告在 try/catch 之外 ---
            let scorePart1, scorePart4;

            // 設定提交中狀態
            submitButton.disabled = true;
            // [學生版] 放大 loading icon h-5 w-5 -> h-6 w-6
            submitButton.innerHTML = `
                <svg class="animate-spin -ml-1 mr-3 h-6 w-6 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                提交中...
            `;
            submitButton.classList.add('bg-gray-400', 'cursor-not-allowed');
            submitButton.classList.remove('bg-blue-600', 'hover:bg-blue-700', 'hover:scale-105');

            try {
                // --- 【修改】在提交前先計算分數 ---
                const scores = calculateScores();
                scorePart1 = scores.scorePart1;
                scorePart4 = scores.scorePart4;

                // 序列化表單數據
                const formData = new FormData(form);
                
                // --- 【修改】將分數附加到 formData 中，以便傳送到後台 ---
                formData.append('Score_Part1', scorePart1);
                formData.append('Score_Part4', scorePart4);

                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: formData, // formData 現在包含分數
                    mode: 'cors' // 確保 Apps Script 部署時允許跨域
                });

                // 處理 Apps Script 回傳的 JSON
                const result = await response.json();
                
                if (result.result === "success") {
                    // --- 【修改】使用已算好的分數顯示 ---
                    showScoreMessage("提交成功！", scorePart1, scorePart4);
                    
                    form.reset(); // 清空表單
                    window.scrollTo({ top: 0, behavior: 'smooth' }); 
                } else {
                    throw new Error(result.error || '提交失敗，但伺服器有回應。');
                }

            } catch (error) {
                console.error('提交錯誤:', error);
                
                // 這是處理 Google Apps Script 常見的 302 重導問題
                // (302 重導時，分數已經在 try 區塊中被計算並賦值)
                if (error.name === 'TypeError' && error.message === 'Failed to fetch' || !error.message) {
                    // --- 【修改】使用已算好的分數顯示 (用於 302 成功) ---
                    showScoreMessage("提交成功！", scorePart1, scorePart4);

                     form.reset();
                     window.scrollTo({ top: 0, behavior: 'smooth' });
                }
                else {
                    showMessage("提交失敗", `發生錯誤，請稍後再試。(${error.message})`);
                }
            } finally {
                // 恢復按鈕狀態
                submitButton.disabled = false;
                submitButton.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-7 h-7">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L6 12Z" />
                    </svg>
                    送出問卷
                `;
                submitButton.classList.remove('bg-gray-400', 'cursor-not-allowed');
                submitButton.classList.add('bg-blue-600', 'hover:bg-blue-700', 'hover:scale-105');
            }
        });

    </script>
</body>

</html>
