<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>各年級學生通學方式互動分析儀表板</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
        }
        .grade-btn.active {
            background-color: #2563eb;
            color: white;
            border-color: #2563eb;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.4);
        }
        .mode-btn.active {
            background-color: white;
            color: #1e293b;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 antialiased min-h-screen pb-12">

    <div class="max-w-6xl mx-auto px-4 py-8">
        <!-- 頁首與切換器 -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-8 gap-6">
            <div>
                <h1 class="text-3xl font-extrabold text-slate-800 tracking-tight">
                    各年級學生通學方式分析儀表板
                </h1>
                <p class="text-slate-500 text-lg mt-1">跨年級互動數據報告 (樣本總數：2,459)</p>
            </div>

            <!-- 人數/百分比切換 -->
            <div class="flex bg-slate-200 p-1 rounded-xl w-fit">
                <button onclick="changeMode('count')" id="btn-count" class="mode-btn active px-6 py-2 rounded-lg text-sm font-bold transition-all">人數</button>
                <button onclick="changeMode('percent')" id="btn-percent" class="mode-btn px-6 py-2 rounded-lg text-sm font-bold transition-all text-slate-500">百分比 (%)</button>
            </div>
        </header>

        <!-- 年級導覽列 -->
        <div class="grid grid-cols-3 md:grid-cols-6 gap-3 mb-10">
            <button onclick="changeGrade(1)" id="grade-1" class="grade-btn active py-3 px-4 rounded-2xl border border-slate-200 bg-white font-bold transition-all hover:border-blue-300">一年級</button>
            <button onclick="changeGrade(2)" id="grade-2" class="grade-btn py-3 px-4 rounded-2xl border border-slate-200 bg-white font-bold transition-all hover:border-blue-300">二年級</button>
            <button onclick="changeGrade(3)" id="grade-3" class="grade-btn py-3 px-4 rounded-2xl border border-slate-200 bg-white font-bold transition-all hover:border-blue-300">三年級</button>
            <button onclick="changeGrade(4)" id="grade-4" class="grade-btn py-3 px-4 rounded-2xl border border-slate-200 bg-white font-bold transition-all hover:border-blue-300">四年級</button>
            <button onclick="changeGrade(5)" id="grade-5" class="grade-btn py-3 px-4 rounded-2xl border border-slate-200 bg-white font-bold transition-all hover:border-blue-300">五年級</button>
            <button onclick="changeGrade(6)" id="grade-6" class="grade-btn py-3 px-4 rounded-2xl border border-slate-200 bg-white font-bold transition-all hover:border-blue-300">六年級</button>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            <!-- 主要圖表區 (佔 3/4) -->
            <div class="lg:col-span-3 bg-white p-6 md:p-8 rounded-3xl shadow-sm border border-slate-100">
                <div class="flex justify-between items-center mb-8">
                    <h2 id="chart-title" class="text-xl font-bold text-slate-800 flex items-center">
                        <span id="display-grade-text" class="mr-2">一年級</span>
                        <span class="text-slate-400 font-normal">| 通學方式分佈</span>
                    </h2>
                    <span id="sample-count" class="bg-blue-50 text-blue-600 px-4 py-1 rounded-full text-sm font-bold">樣本數: 410</span>
                </div>
                
                <div class="chart-container">
                    <canvas id="mainChart"></canvas>
                </div>
            </div>

            <!-- 數據側欄 (佔 1/4) -->
            <div class="space-y-6">
                <!-- 上學冠軍 -->
                <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-100 border-l-8 border-blue-500">
                    <p class="text-sm font-medium text-slate-400 mb-1">上學最主要方式</p>
                    <p id="top-am-name" class="text-xl font-bold text-slate-800">家長機車接送</p>
                    <div class="mt-3 flex items-baseline gap-2">
                        <span id="top-am-val" class="text-2xl font-black text-blue-600">54%</span>
                        <span id="top-am-count" class="text-slate-400 text-sm">(220人)</span>
                    </div>
                </div>

                <!-- 放學冠軍 -->
                <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-100 border-l-8 border-rose-500">
                    <p class="text-sm font-medium text-slate-400 mb-1">放學最主要方式</p>
                    <p id="top-pm-name" class="text-xl font-bold text-slate-800">安親班接送</p>
                    <div class="mt-3 flex items-baseline gap-2">
                        <span id="top-pm-val" class="text-2xl font-black text-rose-500">48%</span>
                        <span id="top-pm-count" class="text-slate-400 text-sm">(200人)</span>
                    </div>
                </div>

                <!-- 獨立性指標 -->
                <div class="bg-slate-800 p-6 rounded-3xl shadow-lg text-white">
                    <div class="flex justify-between items-start mb-4">
                        <p class="text-sm font-medium text-slate-400">獨立通學佔比<br><span class="text-xs">(自行走路)</span></p>
                        <span id="ind-trend" class="text-emerald-400 text-xs font-bold">成長中</span>
                    </div>
                    <div class="flex items-baseline gap-1">
                        <span id="ind-percent" class="text-4xl font-black text-emerald-400">10.2%</span>
                    </div>
                    <div class="mt-6">
                        <div class="w-full bg-slate-700 h-2 rounded-full overflow-hidden">
                            <div id="ind-bar" class="bg-emerald-400 h-full transition-all duration-700" style="width: 10.2%"></div>
                        </div>
                    </div>
                    <p class="text-[10px] text-slate-500 mt-4 leading-relaxed">
                        * 獨立通學佔比計算方式為該年級「自行走路」總人數除以該年級總人數。
                    </p>
                </div>
            </div>
        </div>

        <!-- 頁尾說明 -->
        <footer class="mt-12 text-center text-slate-400 text-sm border-t border-slate-200 pt-8">
            <p>© 2024 學生通勤方式統計分析系統</p>
        </footer>
    </div>

    <script>
        // 設定各年級數據
        const rawData = {
            1: { labels: ['安親班', '自行走路', '其它', '家長陪走', '家長開車', '家長機車', '大眾運輸'], am: [0, 26, 2, 80, 70, 220, 12], pm: [200, 16, 4, 60, 25, 100, 5] },
            2: { labels: ['安親班', '自行走路', '其它', '家長陪走', '家長開車', '家長機車', '大眾運輸'], am: [0, 29, 3, 75, 65, 230, 8],  pm: [210, 19, 5, 55, 20, 95, 6] },
            3: { labels: ['安親班', '自行走路', '其它', '家長陪走', '家長開車', '家長機車', '大眾運輸'], am: [0, 42, 2, 50, 55, 240, 11], pm: [190, 64, 4, 35, 15, 90, 12] },
            4: { labels: ['安親班', '自行走路', '其它', '家長陪走', '家長開車', '家長機車', '大眾運輸'], am: [0, 87, 3, 40, 50, 215, 15], pm: [160, 94, 5, 25, 10, 105, 11] },
            5: { labels: ['安親班', '自行走路', '其它', '家長陪走', '家長開車', '家長機車', '大眾運輸'], am: [0, 108, 4, 30, 40, 210, 18], pm: [140, 115, 4, 15, 15, 100, 11] },
            6: { labels: ['安親班', '自行走路', '其它', '家長陪走', '家長開車', '家長機車', '大眾運輸'], am: [0, 149, 2, 25, 35, 223, 16], pm: [136, 146, 3, 14, 26, 86, 8] }
        };

        let currentGrade = 1;
        let currentMode = 'count'; // 'count' or 'percent'
        let chartInstance = null;

        function changeGrade(grade) {
            currentGrade = grade;
            updateUI();
        }

        function changeMode(mode) {
            currentMode = mode;
            updateUI();
        }

        function updateUI() {
            // 更新按鈕樣式
            document.querySelectorAll('.grade-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`grade-${currentGrade}`).classList.add('active');

            document.getElementById('btn-count').classList.toggle('active', currentMode === 'count');
            document.getElementById('btn-percent').classList.toggle('active', currentMode === 'percent');
            document.getElementById('btn-count').classList.toggle('text-slate-500', currentMode !== 'count');
            document.getElementById('btn-percent').classList.toggle('text-slate-500', currentMode !== 'percent');

            // 數據計算
            const data = rawData[currentGrade];
            const amTotal = data.am.reduce((a, b) => a + b, 0);
            const pmTotal = data.pm.reduce((a, b) => a + b, 0);
            
            const amPercents = data.am.map(v => (v / amTotal * 100).toFixed(1));
            const pmPercents = data.pm.map(v => (v / pmTotal * 100).toFixed(1));

            // 更新文字資訊
            const gradeNames = ['', '一年級', '二年級', '三年級', '四年級', '五年級', '六年級'];
            document.getElementById('display-grade-text').innerText = gradeNames[currentGrade];
            document.getElementById('sample-count').innerText = `樣本數: ${amTotal}人`;

            // 更新側欄數據
            const amMaxIdx = data.am.indexOf(Math.max(...data.am));
            const pmMaxIdx = data.pm.indexOf(Math.max(...data.pm));
            
            document.getElementById('top-am-name').innerText = data.labels[amMaxIdx];
            document.getElementById('top-am-val').innerText = amPercents[amMaxIdx] + '%';
            document.getElementById('top-am-count').innerText = `(${data.am[amMaxIdx]}人)`;

            document.getElementById('top-pm-name').innerText = data.labels[pmMaxIdx];
            document.getElementById('top-pm-val').innerText = pmPercents[pmMaxIdx] + '%';
            document.getElementById('top-pm-count').innerText = `(${data.pm[pmMaxIdx]}人)`;

            // 獨立性指標
            const walkTotal = data.am[1] + data.pm[1];
            const indPct = (walkTotal / (amTotal + pmTotal) * 100).toFixed(1);
            document.getElementById('ind-percent').innerText = indPct + '%';
            document.getElementById('ind-bar').style.width = indPct + '%';
            document.getElementById('ind-trend').innerText = currentGrade >= 4 ? '顯著增長' : '平穩成長';

            // 重新繪圖
            renderChart(data, amPercents, pmPercents);
        }

        function renderChart(data, amPercents, pmPercents) {
            const ctx = document.getElementById('mainChart').getContext('2d');
            
            if (chartInstance) {
                chartInstance.destroy();
            }

            const chartData = {
                labels: data.labels,
                datasets: [
                    {
                        label: '上學人數',
                        data: currentMode === 'count' ? data.am : amPercents,
                        backgroundColor: 'rgba(37, 99, 235, 0.85)',
                        hoverBackgroundColor: '#2563eb',
                        borderRadius: 8,
                        borderWidth: 0
                    },
                    {
                        label: '放學人數',
                        data: currentMode === 'count' ? data.pm : pmPercents,
                        backgroundColor: 'rgba(225, 29, 72, 0.85)',
                        hoverBackgroundColor: '#e11d48',
                        borderRadius: 8,
                        borderWidth: 0
                    }
                ]
            };

            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y', // 改為橫向以利手機閱讀
                    plugins: {
                        legend: { position: 'bottom', labels: { usePointStyle: true, padding: 20, font: { size: 12 } } },
                        tooltip: {
                            backgroundColor: '#1e293b',
                            padding: 12,
                            titleFont: { size: 14, weight: 'bold' },
                            bodyFont: { size: 13 },
                            callbacks: {
                                label: function(context) {
                                    const idx = context.dataIndex;
                                    const dsIdx = context.datasetIndex;
                                    const count = dsIdx === 0 ? data.am[idx] : data.pm[idx];
                                    const pct = dsIdx === 0 ? amPercents[idx] : pmPercents[idx];
                                    return ` ${context.dataset.label}: ${count}人 (${pct}%)`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { display: false },
                            ticks: { font: { size: 11 } },
                            title: { display: true, text: currentMode === 'count' ? '學生人數' : '佔比 (%)' }
                        },
                        y: {
                            grid: { color: '#f1f5f9' },
                            ticks: { font: { size: 12, weight: '500' } }
                        }
                    },
                    animation: {
                        duration: 800,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            Chart.defaults.font.family = "'Noto Sans TC', sans-serif";
            updateUI();
        });
    </script>
</body>
</html>

